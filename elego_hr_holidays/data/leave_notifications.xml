<?xml version="1.0"?>
<odoo>
    <data noupdate="0">

        <!-- Elego Leaves-related subtypes for messaging / Chatter -->
        <record id="mt_lead_create" model="mail.message.subtype">
            <field name="name">Lead Created</field>
            <field name="hidden" eval="True"/>
            <field name="res_model">hr.holidays</field>
            <field name="default" eval="False"/>
            <field name="description">Leave created</field>
        </record>

        <!--Definition of an email template with an empty body that will be used in leave notifications.
            Used to give a basis for email recipients, name and to ease the definition of a further
            elaborated template.  -->
        <record id="email_template_leave_mail" model="mail.template">
            <field name="name">Leaves/Lead Notification</field>
            <field name="model_id" ref="hr_holidays.model_hr_holidays"/>
            <field name="auto_delete" eval="True"/>
            <field name="partner_to">${object.partner_id != False and object.partner_id.id}</field>
            <field name="email_to">${(not object.partner_id and object.email_from)|safe}</field>
            <field name="body_html"></field>
        </record>

        <record id="email_template_new_leave_mail" model="mail.template">
            <field name="name">Leave: New lead created</field>
            <field name="model_id" ref="hr_holidays.model_hr_holidays"/>
            <field name="auto_delete" eval="True"/>
            <field name="email_from">holiday-notification@elegosoft.com</field>
            <field name="partner_to">${object.approvers}</field>
            <!-- <field name="email_to">${object.manager_id.workemail}</field> -->
            <!-- <field name="recipient_ids" search="[...]"/> use group: base.module_category_hr_holidays -->
            <field name="subject">New leave request from ${object.employee_id.name}: ${object.name} </field>
            <field name="body_html"><![CDATA[
<p>Hello HR Manager!,</p>
<p>The employee <strong>${object.employee_id.name}</strong> has created a new leave.
From ${object.date_from} to ${object.date_to} </p>
%if object.notes:
<p>Reasons : </p><p><i>${object.notes}</i>
%endif
</p><p>You can review it!</p>
]]></field>
        </record>

        <!-- Server action -->

        <record id="action_email_new_leave_notif" model="ir.actions.server">
            <field name="name">New Leave notification</field>
            <field name="type">ir.actions.server</field>
            <field name="kind">on_create</field>
            <field name="model_id" ref="hr_holidays.model_hr_holidays"/>
            <field name="condition">True</field>
            <field name="state">email</field>
            <field name="template_id" ref="email_template_new_leave_mail"/>
        </record>

    </data>
</odoo>
